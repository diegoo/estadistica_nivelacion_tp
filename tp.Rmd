---
title: "Nivelación - Estadística - TP"
author: "Diego Dell'Era"
output: pdf_document
---

Dimensiones y crecimiento de los abulones
=========================================

# Propósito

```
Aplicar herramientas de estadística descriptiva & de inferencia para analizar un data set obtenido de: https://archive.ics.uci.edu/ml/datasets/Abalone
```

# Análisis exploratorio

### Cargar los datos

Como la tabla viene sin nombres, se los agregamos usando la información que trae la descripción del data set (`data/dataset.txt`):

```{r, results='markup'}
abulones <- read.csv("data/dataset.csv")
names(abulones) <- c("Sexo", "Longitud", "Diámetro", "Altura", "PesoTotal", "PesoNeto", "PesoVísceras", "PesoCaparazón", "Edad")
```

El data set contiene mediciones de especímenes de un bicho llamado *abulón* (al parecer, es un caracol marino de California). Quienes tomaron las mediciones recolectaron los datos para ver si podían predecir la edad del abulón a partir de sus dimensiones, porque eso es más rápido que el método tradicional (i.e. cortarlo por la mitad, teñirlo y contar los anillos internos mediante el microscopio).

# Primero convertimos el sexo a *character*, porque es más cómodo que un *factor*:
# ```{r, results='markup'}
# abulones$Sex <- as.character(abulones$Sexo)
# ```

Una mirada rápida indica que no hay valores 'null' o faltantes, así que sólo resta validar que ni la altura ni el peso total sean negativos:

```{r, results='markup'}
abulones <- subset(abulones, !(Altura <= 0 | PesoTotal <= 0))
```

Para comodidad, agrupamos los abulones por sexo:

```{r, results='markup'}
machos <- subset(abulones, Sex == 'M')
hembras <- subset(abulones, Sex == 'F')
juveniles <- subset(abulones, Sex == 'I')
```

La altura:

```{r, results='markup'}
qplot(hembras$PesoTotal, binwidth=0.1)

cuartiles:

```{r, results='markup'}
quantile(machos$Altura)
   0%   25%   50%   75%  100% 
0.025 0.130 0.155 0.175 0.515 
```

eliminar los que están más allá de los bigotes, usando la distancia intercuartil:

```{r, results='markup'}
limite_bigote_inferior = mean(machos$Height) - (0.175 - 0.130) * 1.5
limite_bigote_superior = mean(machos$Height) + (0.175 - 0.130) * 1.5
machos <- subset(machos, Height >= limite_bigote_inferior & Height <= limite_bigote_superior)
hist(machos$Height)
```

Para empezar, podemos boxplotear los bichos por sexo:

```{r, results='markup'}
par(mfrow=c(1,3))
boxplot(hembras$Height, main = "hembras")
boxplot(machos$Height, main = "machos")
boxplot(juveniles$Height, main = "juveniles")
```

buscamos qué correlaciones hay, con la matriz:

```{r, results='markup'}
cor(machos[,2:9]) # excluir la columna 1, que tiene el sexo
```

modelo:

```{r, results='markup'}
modelo_altura <- lm(Rings ~ Height, data = machos)
qplot(x = Altura, y = Anillos, data = machos) + geom_smooth(method = lm)
```

### Plotear los datos

```{r, results='markup', fig.width=8, fig.height=4}
require(graphics)
coplot(Anillos ~ Altura, data = machos, panel = panel.smooth, xlab = "edad en términos de altura")
```

relación entre altura/peso y edad:

```{r, results='markup'}
qplot(PesoCaparazon, Anillos, data=abulones, geom=c("point", "smooth"), method="lm")
```

y facetando por sexo:

```{r, results='markup'}
ggplot(abulones, aes(Altura, Anillos)) + geom_jitter(alpha=0.25) + geom_smooth(method=lm, se=FALSE) +  facet_grid(. ~ Sexo)
```

It shows that there is a clear link between higher doses and tooth length. The link between supplement type is not so clear, i.e. to the naked eye, the curves look pretty similar for both supplements.

We can also plot boxes for each variable: first, tooth length as a function of the supplement type, then tooth length as a function of the dose.

```{r, results='markup', fig.width=8, fig.height=4}
par(mfrow=c(1,2))
boxplot(len ~ supp, data = ToothGrowth, main = "Tooth growth | supplement type")
boxplot(len ~ dose, data = ToothGrowth, main = "Tooth growth | dose")
```

We are going to compare samples (two at a time) using *Student's t-test*.

#### Assumptions:

- 1. the two samples are taken from populations that follow a Gaussian distribution. Histograms for tooth length show that they are indeed quite normal, if a bit skewed:

```{r, results='markup', fig.width=8, fig.height=4}
par(mfrow=c(1,2))
hist(ToothGrowth[ToothGrowth$supp == 'OJ',][1]$len, main = "tooth length | OJ", ylab = "length", xlab = "")
hist(ToothGrowth[ToothGrowth$supp == 'VC',][1]$len, main = "tooth length | VC", ylab = "length", xlab = "")
```

- 2. the samples are *iid*.

- 3. the number of observations is rather small, so Student's t-test is appropiate.

#### Test Setup

We divide the observations in arrays by (dose + supplement type)

```{r, results='markup'}
dose05_suppOJ <- ToothGrowth[ToothGrowth$supp == 'OJ' & ToothGrowth$dose == 0.5,]$len
dose05_suppVC <- ToothGrowth[ToothGrowth$supp == 'VC' & ToothGrowth$dose == 0.5,]$len
```

#### Test results

Now we compare the two supplement types as the dose increases from 0 to 0.5 and from 0.5 to 1 ml.:

```{r, results='markup',echo=TRUE}
t.test(dose05_suppOJ, dose05_suppVC, paired=FALSE, conf.level = 0.95)$p.value
```

In both cases (from 0 to 0.5, from 0.5 to 1) there is a significant difference between supplement types, because the p-values are lower than 0.05 at a confidence level of 0.95.
This means that, if the $H_0$ hypothesis is that there is no difference between the effect of each supplement on mean tooth length, then with these p-values that hypothesis can be rejected.

...The p-value is now greater than 0.05. Also, The confidence interval for mean length increase contains the value 0. We conclude from these two points that we cannot reject the $H_0$ hypothesis.
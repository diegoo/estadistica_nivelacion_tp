---
title: "Nivelación - Estadística - TP"
author: "Diego Dell'Era"
output: pdf_document
---

Dimensiones y crecimiento de los abulones
=========================================

# Propósito

```
Aplicar herramientas de estadística descriptiva & de inferencia para analizar un data set obtenido del UCI Machine Learning Data Set Repository: https://archive.ics.uci.edu/ml/datasets/Abalone
```

# Análisis exploratorio

### Cargar los datos

Como la tabla viene sin nombres, se los agregamos usando la información que trae la descripción del data set (`data/dataset.txt`):

```{r, results='markup'}
abulones <- read.csv("data/dataset.csv")
names(abulones) <- c("Sexo", "Longitud", "Diámetro", "Altura", "PesoTotal", "PesoNeto", "PesoVísceras", "PesoCaparazón", "Edad")
```

El data set contiene mediciones de especímenes de un bicho llamado *abulón* (al parecer, es un caracol marino de California). Quienes tomaron las mediciones recolectaron los datos para ver si podían predecir la edad del abulón a partir de sus dimensiones, porque eso es más rápido que el método tradicional (i.e. cortarlo por la mitad, teñirlo y contar los anillos internos mediante el microscopio; la edad del abulón es = nro. de anillos + 1.5).

# Primero convertimos el sexo a *character*, porque es más cómodo que un *factor*:
# ```{r, results='markup'}
# abulones$Sex <- as.character(abulones$Sexo)
# ```

Una mirada rápida a los datos indica que no hay valores 'null' o faltantes, así que sólo resta validar que ni la altura ni el peso total sean negativos:

```{r, results='markup'}
abulones <- subset(abulones, !(Altura <= 0 | PesoTotal <= 0))
```

Para comodidad, agrupamos los abulones por sexo:

```{r, results='markup'}
machos <- subset(abulones, Sex == 'M')
hembras <- subset(abulones, Sex == 'F')
juveniles <- subset(abulones, Sex == 'I')
```

La altura:

```{r, results='markup'}
qplot(hembras$PesoTotal, binwidth = 0.1)

cuartiles:

```{r, results='markup'}
quantile(machos$Altura)
   0%   25%   50%   75%  100% 
0.025 0.130 0.155 0.175 0.515 
```

eliminar los que están más allá de los bigotes (usando 1.5 * la distancia intercuartil):

```{r, results='markup'}
limite_bigote_inferior = mean(machos$Altura) - (0.175 - 0.130) * 1.5
limite_bigote_superior = mean(machos$Altura) + (0.175 - 0.130) * 1.5
machos <- subset(machos, Altura >= limite_bigote_inferior & Altura <= limite_bigote_superior)
hist(machos$Altura)
```

Para empezar, podemos boxplotear los bichos por sexo:

```{r, results='markup'}
par(mfrow=c(1,3))
boxplot(hembras$Altura, main = "hembras")
boxplot(machos$Altura, main = "machos")
boxplot(juveniles$Altura, main = "juveniles")
```

Para saber cuál(es) de las variables podríamos usar para predecir la edad (i.e. los Anillos), empezamos por calcular el índice de correlación entre la edad y cada una de esas variables. En realidad, podemos pedir la matriz de todas las correlaciones, que es más fácil. Excluimos la columna 1, que tiene el sexo, porque no sirve para predecir.

```{r, results='markup'}
cor(machos[,2:9]) 
```

(Es natural que haya correlación entre los pesos de las distintas partes del bicho y el peso total).

modelo:

```{r, results='markup'}
modelo_altura <- lm(Rings ~ Height, data = machos)
qplot(x = Altura, y = Anillos, data = machos) + geom_smooth(method = lm)
```

### Plotear los datos

```{r, results='markup', fig.width=8, fig.height=4}
require(graphics)
coplot(Anillos ~ Altura, data = machos, panel = panel.smooth, xlab = "edad en términos de altura")
```

relación entre altura/peso y edad:

```{r, results='markup'}
qplot(PesoCaparazon, Anillos, data=abulones, geom=c("point", "smooth"), method="lm")
```

y facetando por sexo:

```{r, results='markup'}
ggplot(abulones, aes(Altura, Anillos)) + geom_jitter(alpha=0.25) + geom_smooth(method=lm, se=FALSE) + facet_grid(. ~ Sexo)
```

```{r, results='markup', fig.width=8, fig.height=4}
par(mfrow=c(1,2))
boxplot(len ~ supp, data = ToothGrowth, main = "Tooth growth | supplement type")
boxplot(len ~ dose, data = ToothGrowth, main = "Tooth growth | dose")
```

Vamos a comparar muestras mediante el t-test de Student.

#### Premisas:

- 1. las muestras son *iid* y tienen una distribución normal.

* TODO => graficar!

```{r, results='markup', fig.width=8, fig.height=4}
par(mfrow=c(1,2))
hist(ToothGrowth[ToothGrowth$supp == 'OJ',][1]$len, main = "tooth length | OJ", ylab = "length", xlab = "")
hist(ToothGrowth[ToothGrowth$supp == 'VC',][1]$len, main = "tooth length | VC", ylab = "length", xlab = "")
```

- 2. the samples are *iid*.

- 3. the number of observations is rather small, so Student's t-test is appropiate.

#### Test Setup

We divide the observations in arrays by (dose + supplement type)

```{r, results='markup'}
dose05_suppOJ <- ToothGrowth[ToothGrowth$supp == 'OJ' & ToothGrowth$dose == 0.5,]$len
dose05_suppVC <- ToothGrowth[ToothGrowth$supp == 'VC' & ToothGrowth$dose == 0.5,]$len
```

#### Test results

```{r, results='markup',echo=TRUE}
t.test(dose05_suppOJ, dose05_suppVC, paired=FALSE, conf.level = 0.95)$p.value
```

In both cases (from 0 to 0.5, from 0.5 to 1) there is a significant difference between supplement types, because the p-values are lower than 0.05 at a confidence level of 0.95. This means that, if the $H_0$ hypothesis is that there is no difference between the effect of each supplement on mean tooth length, then with these p-values that hypothesis can be rejected.

...The p-value is now greater than 0.05. Also, The confidence interval for mean length increase contains the value 0. We conclude from these two points that we cannot reject the $H_0$ hypothesis.